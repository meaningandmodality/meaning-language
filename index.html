<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home | Meaning & Modality Lab</title>
    <link rel="stylesheet" href="CSS/style.css">
</head>
<body>

<!-- Inserting header from header.html stored in /partials. Use JavaScript -->
<div id="header"></div>

    <div id="main-content">
        <!-- Content will be loaded here dynamically -->
    </div>
    
    <div id="footer"></div>
        <script>
                fetch("partials/header.html")
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById("header").innerHTML = data;
                    });

                fetch("partials/footer.html")
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById("footer").innerHTML = data;
                    });

            //Function to load publications from text file
            function loadPublications() {
                fetch('data/publications.txt')
                .then(res => res.text())
                .then(text => {
                    const lines = text.trim().split('\n');
                    let html = '';
                    let currentYear = '';

                    lines.forEach(line => {
                    if (/^\d{4}$/.test(line)) {
                        if (currentYear) html += '</ul>';
                        currentYear = line;
                        html += `<h3>${currentYear}</h3><ul>`;
                    } else if (line.trim()) {
                        const [authors, title, venue, file] = line.split('|').map(p => p.trim());
                        html += `<li><strong>${authors}</strong> ${title} ${venue ? venue : ''} <a href="documents/${file}">[${file.split('.').pop()}]</a></li>`;
                    }
                    });

                    html += '</ul>';
                    document.getElementById('main-content').innerHTML = html;
                });
            }

            //Function to load research from text file
            function loadResearch() {
                fetch('data/research.txt')
                .then(res => res.text())
                .then(text => {
                    const lines = text.trim().split('\n');
                    let html = '';

                    lines.forEach(line => {
                    if (line.trim()) {
                        const [project, description, info] = line.split('|').map(p => p.trim());
                        html += `<li><strong>${project}</strong> ${description}''} <a href="documents/${info}">[${info.split('.').pop()}]</a></li>`;
                        }
                    });

                    html += '</ul>';
                    document.getElementById('main-content').innerHTML = html;
                });
            }

            function loadNews() {
                fetch('data/news.txt')
                    .then(res => res.text())
                    .then(text => {
                    const lines = text.trim().split('\n');
                    let html = '';

                lines.forEach(line => {
                    if (line.trim()) {
                    const [title, date, des, file] = line.split('|').map(p => p.trim());
                    html += `<li><strong>${title}</strong> (${date}) – ${des}`;
                    if (file) html += ` <a href="Documents/${file}">[${file.split('.').pop()}]</a>`;
                    html += '</li>';
                    }
                    });

                document.getElementById('news-list').innerHTML = html;
                });
            }
                // Smart router: detect URL and load appropriate txt file
function loadStructuredContent(txtFile) {
  fetch(txtFile)
    .then(res => res.text())
    .then(text => {
      const lines = text.trim().split('\n');
      let html = '';
      let currentClass = '';

      lines.forEach(line => {
        const trimmed = line.trim().toLowerCase();

        if (trimmed === 'welcome') {
          if (currentClass) html += '</div>';
          html += '<div class="intro"><h2>Welcome</h2>';
          currentClass = 'intro';
        } else if (trimmed === 'publications') {
          if (currentClass) html += '</div>';
          html += '<div class="pubs"><h2>Publications</h2><ul>';
          currentClass = 'pubs';
        } else if (trimmed === 'team') {
          if (currentClass) html += '</div>';
          html += '<div class="team"><h2>Team</h2><ul class="people-list">';
          currentClass = 'team';
        } else if (trimmed === 'research') {
          if (currentClass) html += '</div>';
          html += '<div class="projects"><h2>Research</h2><ul>';
          currentClass = 'projects';
        } else if (line.trim()) {
          if (currentClass === 'pubs' || currentClass === 'projects') {
            const [a, b, c, d] = line.split('|').map(p => p.trim());
            html += `<li><strong>${a}</strong> ${b} ${c || ''}`;
            if (d) html += ` <a href="Documents/${d}">[${d.split('.').pop()}]</a>`;
            html += '</li>';
          } else if (currentClass === 'team') {
            const [name, role, email] = line.split('|').map(p => p.trim());
            html += `<li><strong>${name}</strong> – ${role}<br><em>${email || ''}</em></li>`;
          } else {
            html += `<p>${line}</p>`;
          }
        }
      });

      if (currentClass) html += '</div>';
      document.getElementById("main-content").innerHTML = html;
    });
}

function loadPage(htmlFile) {
  fetch(htmlFile)
    .then(response => response.text())
    .then(data => {
      document.getElementById("main-content").innerHTML = data;
    });
}

function handleRouting() {
  const params = new URLSearchParams(window.location.search);
  const page = params.get('page') || 'home';

  if (page === 'publications' || page === 'research') {
    loadStructuredContent(`data/${page}.txt`);
  } else {
    loadPage(`partials/${page}.html`);
    if (page === 'home') {
      // Slight delay to ensure the container exists before loading news
      setTimeout(loadNews, 150);
    }
  }
}

// Handle back/forward browser buttons
window.onpopstate = handleRouting;

// Initial page load
window.onload = () => {
  handleRouting();

  // Optional: turn nav links into soft navigators
  document.querySelectorAll('nav a').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const url = this.getAttribute('href');
      history.pushState({}, '', url); // update the address bar
      handleRouting(); // load the content
    });
  });
};
        </script>

</body>
</html>